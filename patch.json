{
    "rationale": "The patch addresses four security vulnerabilities identified by Semgrep:\n1.  **SQL Injection**: The `/add` endpoint was vulnerable to SQL injection because it used an f-string to construct a raw SQL query with user input. This is fixed by using the SQLAlchemy ORM to create new `Todo` objects, which uses parameterized queries under the hood and prevents SQL injection. This also makes the code consistent with other parts of the application.\n2.  **Tainted SQL String**: This is the same issue as the SQL injection, identified by a different Semgrep rule. The fix for SQL injection also resolves this.\n3.  **Insecure Hash Algorithm**: The `api_create_todo` endpoint used MD5 for hashing, which is a weak hashing algorithm. This has been replaced with SHA256, which is a secure alternative.\n4.  **Flask Debug Mode**: The application was running with `debug=True` hardcoded, which is insecure for production environments. This is fixed by making the debug mode configurable via a `FLASK_DEBUG` environment variable, defaulting to off. An `import os` statement was added to support this.",
    "patch": "--- a/app.py\n+++ b/app.py\n@@ -1,5 +1,6 @@\n from flask import Flask, render_template, request, redirect, url_for, jsonify\n from flask_sqlalchemy import SQLAlchemy\n import hashlib\n+import os\n \n app = Flask(__name__)\n app.config[\"SQLALCHEMY_DATABASE_URI\"] = \"sqlite:///todo.db\"\n@@ -21,9 +22,9 @@\n def add():\n     title = request.form.get(\"title\")\n     if title:\n-        sql = f\"INSERT INTO todo (title, complete) VALUES ('{title}', 0)\"\n-        db.session.execute(sql)\n+        new_todo = Todo(title=title, complete=False)\n+        db.session.add(new_todo)\n         db.session.commit()\n     return redirect(url_for(\"index\"))\n \n@@ -153,7 +154,7 @@\n     todo = Todo(title=title, complete=False)\n     db.session.add(todo)\n     db.session.commit()\n-    sig = hashlib.md5(title.encode()).hexdigest()\n+    sig = hashlib.sha256(title.encode()).hexdigest()\n     print(f\"Storing signature for todo {todo.id}: {sig}\")\n \n     return jsonify({\n@@ -251,4 +252,4 @@\n     db.create_all()\n \n if __name__ == \"__main__\":\n-  app.run(debug=True)\n+  app.run(debug=os.environ.get('FLASK_DEBUG', '').lower() == 'true')\n"
}